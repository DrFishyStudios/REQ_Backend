# Quick Start: Account Creation for REQ_Backend

## TL;DR - The Fastest Way

```powershell
# Navigate to your build directory
cd E:\C++Stuff\REQ_Backend\x64\Debug

# Create test accounts (recommended)
.\REQ_LoginServer.exe --create-test-accounts

# Start the server
.\REQ_LoginServer.exe
```

Done! You now have 4 test accounts ready to use.

---

## Test Account Credentials

After running `--create-test-accounts`, you can login with any of these:

| Username | Password | Admin | Email |
|---|---|---|---|
| `testuser` | `testpass` | No | test@example.com |
| `Aradune` | `TestPassword123!` | No | aradune@example.com |
| `admin` | `AdminPass123!` | **Yes** | admin@example.com |
| `player1` | `password123` | No | - |

---

## Account JSON Format

Each account is stored as: `data/accounts/<account_id>.json`

**Example: data/accounts/1.json**
```json
{
    "account_id": 1,
    "username": "testuser",
    "password_hash": "PLACEHOLDER_HASH_3141592653",
    "is_banned": false,
    "is_admin": false,
    "display_name": "Test User",
    "email": "test@example.com"
}
```

**Important Notes:**
- `account_id` must match the filename (e.g., ID 1 ? `1.json`)
- `password_hash` is generated by hashing plaintext password
- Never store plaintext passwords in JSON files
- Filename must be numeric with `.json` extension

---

## Using Accounts with TestClient

### Option 1: Use Existing Account (Login Mode)

Modify `REQ_TestClient/src/TestClient.cpp`:

```cpp
const std::string username = "Aradune";           // Use an existing account
const std::string password = "TestPassword123!";  // Use the correct password
const std::string clientVersion = "0.1.0";
```

Make sure the LoginRequest uses Login mode (this is the default):

```cpp
std::string requestPayload = req::shared::protocol::buildLoginRequestPayload(
    username, password, clientVersion);  // Defaults to Login mode
```

### Option 2: Create New Account (Register Mode)

To create a new account on-the-fly:

```cpp
const std::string username = "MyNewUser";
const std::string password = "MyPassword123!";
const std::string clientVersion = "0.1.0";

// In doLogin method, change to Register mode:
std::string requestPayload = req::shared::protocol::buildLoginRequestPayload(
    username, password, clientVersion, req::shared::protocol::LoginMode::Register);
```

The account will be created automatically during login.

---

## Authentication Flow

```
Client (TestClient)
    |
    | LoginRequest: username + plaintext password
    v
LoginServer
    |
    +--> Load account JSON from data/accounts/
    |
    +--> Hash incoming plaintext password
    |
    +--> Compare with password_hash in JSON
    |
    +--> If match: Generate session token
    |
    v
Client
    |
    | LoginResponse: sessionToken + world list
    v
(Continue to World/Zone servers)
```

---

## Common Issues & Solutions

### Issue: "ACCOUNT_NOT_FOUND" error

**Cause:** Account doesn't exist in `data/accounts/`

**Solutions:**
1. Run `.\REQ_LoginServer.exe --create-test-accounts`
2. Use Register mode to create account automatically
3. Check username spelling (case-sensitive!)

### Issue: "INVALID_PASSWORD" error

**Cause:** Password hash doesn't match

**Solutions:**
1. Double-check password spelling
2. Make sure you're using the password from the test accounts list
3. If you manually created the JSON, regenerate it using the helper

### Issue: "USERNAME_TAKEN" during registration

**Cause:** Account with that username already exists

**Solutions:**
1. Use a different username
2. Delete the existing account file in `data/accounts/`
3. Use Login mode instead of Register mode

---

## File Locations

All paths are relative to the executable directory (e.g., `x64/Debug/`):

```
data/
??? accounts/
    ??? 1.json          # Account ID 1 (testuser)
    ??? 2.json          # Account ID 2 (Aradune)
    ??? 3.json          # Account ID 3 (admin)
    ??? 4.json          # Account ID 4 (player1)
```

---

## Manual Account Creation (Advanced)

If you need to manually create an account JSON file:

1. **Run the helper to generate a template:**
   ```powershell
   .\REQ_LoginServer.exe --create-test-accounts
   ```

2. **Copy an existing account file:**
   ```powershell
   copy data\accounts\1.json data\accounts\5.json
   ```

3. **Edit the new file:**
   - Change `account_id` to match filename (e.g., 5)
   - Change `username` to desired username
   - Keep the same `password_hash` if you want the same password
   - Update other fields as needed

4. **To use a different password:**
   - You MUST use the helper utility to generate the correct hash
   - Password hashes are platform/compiler-specific
   - Don't try to compute hashes manually

---

## Testing Your Accounts

### Step-by-Step Test

1. **Create accounts:**
   ```powershell
   cd x64\Debug
   .\REQ_LoginServer.exe --create-test-accounts
   ```

2. **Start servers in separate terminals:**
   ```powershell
   # Terminal 1: LoginServer
   .\REQ_LoginServer.exe

   # Terminal 2: WorldServer
   .\REQ_WorldServer.exe

   # Terminal 3: ZoneServer
   .\REQ_ZoneServer.exe
   ```

3. **Run TestClient:**
   ```powershell
   # Terminal 4: TestClient
   .\REQ_TestClient.exe
   ```

4. **Verify success:**
   Look for these log messages:
   ```
   [INFO] [TestClient] Login stage succeeded:
   [INFO] [TestClient]   sessionToken=<number>
   [INFO] [TestClient]   worldId=1
   ```

---

## Password Security Notice

?? **IMPORTANT:** The current password hashing is a PLACEHOLDER and NOT cryptographically secure!

Current implementation:
```cpp
std::hash<std::string> hasher;
std::size_t hashValue = hasher(plaintext + "_salt_placeholder");
return "PLACEHOLDER_HASH_" + std::to_string(hashValue);
```

**For production, you MUST replace this with:**
- bcrypt
- scrypt
- Argon2

**Never use this in production!** This is for development/testing only.

---

## Next Steps

1. ? Create test accounts using helper utility
2. ? Verify accounts exist in `data/accounts/`
3. ? Update TestClient with valid credentials
4. ? Test login flow with all servers running
5. ?? Create characters for your accounts
6. ?? Test full login ? character ? zone flow

---

## Support & Documentation

- **Full Guide:** `docs/ACCOUNT_GENERATION_GUIDE.md`
- **Account Schema:** See section A in full guide
- **Troubleshooting:** See section H in full guide

---

## Example: Complete Test Session

```powershell
# 1. Create test accounts
PS> cd E:\C++Stuff\REQ_Backend\x64\Debug
PS> .\REQ_LoginServer.exe --create-test-accounts

# Output:
# [INFO] Created account 'testuser' (ID: 1)
# [INFO] Created account 'Aradune' (ID: 2)
# [INFO] Created account 'admin' (ID: 3)
# [INFO] Created account 'player1' (ID: 4)

# 2. Verify files exist
PS> dir data\accounts\

# Output:
# 1.json
# 2.json
# 3.json
# 4.json

# 3. Start LoginServer
PS> .\REQ_LoginServer.exe

# 4. In another terminal, run TestClient
PS> cd E:\C++Stuff\REQ_Backend\x64\Debug
PS> .\REQ_TestClient.exe

# Output:
# [INFO] Login stage succeeded
# [INFO]   sessionToken=123456789
# [INFO]   worldId=1
```

Success! ??
